<!DOCTYPE html>
<html lang="en">

    <head>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>OnlineSherpa</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
        <link type="text/css" rel="stylesheet" href="css/materialize.css"/>

    </head>

    <body>

        <ul id="dropdown1" class="dropdown-content">
            <li><a href="prRaidsV.html">Raids</a></li>
            <li><a href="prDungeonsV.html">Dungeons</a></li>
            <li class="divider"></li>
            <li><a href="prAPI.html">(Api Page)</a></li>
        </ul>
        <nav>
            <div class="nav-wrapper">
            <a href="index.html" class="brand-logo">OnlineSherpa</a>
            <ul class="right hide-on-med-and-down">
                <li><a href="prRaidsU.html">Raids</a></li>
                <li><a href="prDungeonsU.html">Dungeons</a></li>
                <li><a href="prAPI.html">(Api Page)</a></li>
                <li><a class="dropdown-trigger" data-target="dropdown1">Vaulted<i class="material-icons right">arrow_drop_down</i></a></li>
            </ul>
            </div>
        </nav>

        <div class="parallax-A"></div>

        <h1>API Page</h1>

        <label for="select">Select your platform:</label>
        <select name="Platform", id="Plat-in">
            <option value="Select">Select A Platform</option>
            <option value="-1">All</option>
            <option value="1">XBox</option>
            <option value="2">PlayStation</option>
            <option value="3">Steam</option>
            <option value="4">Blizzard</option>
            <option value="5">Stadia</option>
        </select>
        <br>
        <label for="input">Enter Gamertag/PSN:</label>
        <input id="Name-in">

        <button onclick="getInfo()" class="btn-floating">Submit</button>

        <button onclick="getItem()" class="btn-floating">Test</button>

        <button onclick="Oauth()" class="btn-floating">Oauth</button>

        <div class="parallax-A"></div>
        
    </body>

    <script type="text/javascript" src="js/materialize.min.js"></script>
    <script type = "text/javascript">

        $(document).ready(function() {
            console.log("Got here");
            $(".dropdown-trigger").dropdown();
        });

        document.addEventListener('DOMContentLoaded', function() {
            var elems = document.querySelectorAll('.parallax');
            var instances = M.Parallax.init(elems, 0);
        });

        function clear() {

            document.getElementById("Name-in").value = "";
            document.getElementById("Plat-in").value = "Select";

        };

        var endPoint = "https://www.bungie.net/Platform"
        var apiKey = "05e3ca94078a4f90a6ced1a0bca23812";
        var OauthURL = "https://www.bungie.net/en/OAuth/Authorize";
        var OauthKey = "35277";
        var xhr = new XMLHttpRequest();

        function Oauth() {

            var Oauth = xhr.open("GET", OauthURL + "?client_id=" + OauthKey +"&response_type=code");
            xhr.setRequestHeader("X-API-Key", apiKey);

            xhr.onreadystatechange = function() {
                if(this.readyState === 4 && this.status === 200) {
                    var json = JSON.parse(this.responseText);
                    console.log(json.Response.data);
                } 
            }

            xhr.send()

        };

        async function getInfo() {

            await getOpen();
            await getLog();
            await getSend();

        }

        async function getOpen() {

            var Plat = document.getElementById("Plat-in").value;
            var Name = document.getElementById("Name-in").value;

            console.log(Name)
            
            xhr.open("GET", endPoint + "/Destiny2/SearchDestinyPlayer/-1/" + Name + "/");
            xhr.setRequestHeader("X-API-Key", apiKey);

        };

        async function getLog() {

            xhr.onreadystatechange = function() {
                if(this.readyState === 4 && this.status === 200) {
                    response = JSON.parse(this.responseText);
                    console.log(response);
                    console.log(response.Response[0].displayName)
                }; 
            };
        };

        async function getSend() {

            xhr.send();

            clear();

        }

        async function getItem() {

            await testOpen();
            await testLog();
            await testSend();
            
        };

        async function testOpen() {

            xhr.open("GET", endPoint + "/Destiny/Manifest/InventoryItem/1274330687/", true);
            xhr.setRequestHeader("X-API-Key", apiKey);  

        };

        async function testLog() {

            xhr.onreadystatechange = function() {
                if(this.readyState === 4 && this.status === 200) {
                    var json = JSON.parse(this.responseText);
                    console.log(json.Response.data.inventoryItem.itemName); //Gjallarhorn
                };
            };

        };

        async function testSend() {

            xhr.send();

        };
  
    </script>

</html>

{"Response":
[{"iconPath":"/img/theme/bungienet/icons/psnLogo.png",
"crossSaveOverride":0,
"isPublic":false,
"membershipType":3,
"membershipId":"4611686018492887422",
"displayName":"Pika"}],
"ErrorCode":1,
"ThrottleSeconds":0,
"ErrorStatus":"Success",
"Message":"Ok",
"MessageData":{}}